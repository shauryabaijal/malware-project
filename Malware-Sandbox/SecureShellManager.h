//
// Created by adhokshajmishra on 27/7/20.
//

#ifndef SANDBOXER_SECURESHELLMANAGER_H
#define SANDBOXER_SECURESHELLMANAGER_H

#include <libssh/libssh.h>
#include <string>

class InteractiveShell {
private:
    ssh_session session;
    ssh_channel channel;
public:
    InteractiveShell(ssh_session session);
    int initialize(std::string command);
    int write_to_channel(std::string data);
    int read_from_channel(std::string& buffer_out, std::string& buffer_err);
    void close_current_channel();
};

class SecureShellManager {
private:
    std::string host;
    int port;

    ssh_session session;
    ssh_key server_pubkey;
    unsigned char* hash;
    size_t hash_length;
protected:
public:
    SecureShellManager(std::string host = "", int port = 0);
    ~SecureShellManager();
    int connect(std::string username, std::string password);
    int executeRemoteCommand(std::string command, std::string& out, std::string& err, unsigned int timeout_seconds,
            std::string sudo_password = "");
    int uploadFile(std::string path,std::string filename, const std::string& data);
    int downloadFile(std::string remote_path, std::string local_path);
    InteractiveShell getInteractiveShell();
};

#endif //SANDBOXER_SECURESHELLMANAGER_H
